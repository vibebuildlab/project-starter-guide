#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running smart pre-push validation..."

# Check if smart test strategy script exists
if [ -f "scripts/smart-test-strategy.sh" ]; then
  bash scripts/smart-test-strategy.sh
else
  # Fallback to basic validation
  echo "ğŸ“ Linting..."
  npm run lint || {
    echo "âŒ Lint failed! Fix errors before pushing."
    exit 1
  }

  echo "âœ¨ Checking formatting..."
  npm run format:check || {
    echo "âŒ Format check failed! Run 'npm run format' to fix."
    exit 1
  }

  # Run tests if they exist
  if node -e "const pkg=require('./package.json');process.exit(pkg.scripts.test?0:1)" 2>/dev/null; then
    echo "ğŸ§ª Running tests..."
    npm test || {
      echo "âŒ Tests failed! Fix failing tests before pushing."
      exit 1
    }
  fi

  echo "âœ… Pre-push validation passed!"
fi
